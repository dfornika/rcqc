
{
    "rulesets": [
        {
            "name": "settings-salmonella",
            "rules": [
                [
                    "store",
                    4857000,
                    "report/contigs/reference_genome_size"
                ],
                [
                    "store",
                    "serovar Typhimurium LT2",
                    "report/contigs/reference_genome"
                ],
                [
                    "store",
                    0.10000000000000001,
                    "report/contigs/good_genome_size_ratio"
                ]
            ]
        },
        {
            "name": "settings-ecoli",
            "rules": [
                [
                    "store",
                    5324560,
                    "report/contigs/reference_genome_size"
                ],
                [
                    "store",
                    "E. coli ATCC 35150 NalR",
                    "report/contigs/reference_genome"
                ],
                [
                    "store",
                    "ASM93507v1",
                    "report/contigs/reference_genome_assembly"
                ],
                [
                    "store",
                    0.29999999999999999,
                    "report/contigs/good_genome_size_ratio"
                ]
            ]
        },
        {
            "name": "processing",
            "rules": [
                [
                    "store",
                    [
                        "loadFileByName",
                        "flash.log"
                    ],
                    "file/flash/flash_text"
                ],
                [
                    "store",
                    "\\[FLASH]\\s*(?P<name>\\w+[\\s\\w]*):\\s*(?P<value>[^\\n]*)",
                    "myregexpressions/re_flash_param"
                ],
                [
                    "store",
                    [
                        "regexp",
                        [
                            "section",
                            "/flash_text",
                            "Read combination statistics:",
                            "Writing histogram files."
                        ],
                        "/re_flash_param",
                        "nameUnderScore"
                    ],
                    "report/flash/parameters/%(name)s"
                ],
                [
                    "iterate",
                    [
                        "readFileByName",
                        "contigs-all.fasta"
                    ],
                    [
                        "if",
                        [
                            [
                                "getitem",
                                "iterator/0/value",
                                0
                            ],
                            "==",
                            ">"
                        ],
                        [
                            "append",
                            [
                                "regexp",
                                "iterator/0/value",
                                "length_(?P<value>\\d+)_"
                            ],
                            "report/contigs/contig_lengths"
                        ]
                    ]
                ],
                [
                    "store",
                    [
                        "fsum",
                        "/contig_lengths"
                    ],
                    "report/contigs/sample_genome_size"
                ],
                [
                    "store",
                    [
                        [
                            "abs",
                            [
                                "/sample_genome_size",
                                "-",
                                "/reference_genome_size"
                            ]
                        ],
                        "/",
                        "/reference_genome_size"
                    ],
                    "report/contigs/genome_size_ratio"
                ],
                [
                    "if",
                    [
                        "/genome_size_ratio",
                        ">",
                        "/good_genome_size_ratio"
                    ],
                    [
                        "fail",
                        "report/job/status"
                    ]
                ],
                [
                    "store",
                    [
                        "length",
                        "/contig_lengths"
                    ],
                    "report/contigs/count"
                ],
                [
                    "store",
                    [
                        "statisticN",
                        "/contig_lengths",
                        50
                    ],
                    "report/contigs/N50"
                ],
                [
                    "store",
                    [
                        "statisticN",
                        "/contig_lengths",
                        99
                    ],
                    "report/contigs/N99"
                ],
                [
                    "store",
                    [
                        "sorted",
                        "/contig_lengths"
                    ],
                    "/contig_lengths"
                ],
                [
                    "if",
                    [
                        "N50",
                        "<",
                        200000
                    ],
                    [
                        "fail",
                        "report/job/status"
                    ]
                ],
                [
                    "if",
                    [
                        "N99",
                        "<",
                        2000
                    ],
                    [
                        "fail",
                        "report/job/status"
                    ]
                ],
                [
                    "if",
                    [
                        "report/contigs/count",
                        ">",
                        200
                    ],
                    "fail"
                ],
                [
                    "writeFile",
                    [
                        "pageHtml",
                        [
                            "getHtml",
                            "report",
                            "My Report Widget"
                        ]
                    ],
                    "report.html"
                ],
                [
                    "writeFile",
                    [
                        "getTabular",
                        "report/flash/parameters"
                    ],
                    "tabular_report.tab"
                ],
                [
                    "iconcat",
                    "report_html",
                    [
                        "getHtml",
                        "report",
                        "My Tool Report"
                    ]
                ]
            ]
        }
    ]
}
